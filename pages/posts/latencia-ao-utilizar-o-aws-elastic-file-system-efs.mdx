import { withRouter } from 'next/router'
import BlogPost from '../../components/layouts/blog-post'

export const meta = {
  published: true,
  publishedAt: '2020-02-21',
  title: 'Lat√™ncia ao utilizar o AWS Elastic File System (EFS)',
  summary: 'O EFS EFS √© um dos servi√ßos que a AWS nos oferece, e se destaca por ser, basicamente, um File System NFS na nuvem de baix√≠ssimo custo. Ele foi criado com o intuito de fornecer acesso compartilhado e paralelo para at√© milhares de inst√¢ncias EC2, permitindo que sua aplica√ß√£o forne√ßa alto n√≠vel em taxa de transfer√™ncia com baixa lat√™ncia.',
  image: '/static/site-feature.png',
  language: 'br',
}

export default withRouter(({ children, router }) => (
  <BlogPost language={meta.language} path={router.pathname} meta={meta}>
    {children}
  </BlogPost>
))

Anteriormente, aqui no blog, fiz uma postagem sobre como resolver um erro bem comum na integra√ß√£o de um EFS e inst√¢ncias EC2 privadas. Se voc√™ ainda n√£o viu, vale a pena conferir. üòú [Clique aqui](/posts/efs-error-failed-to-resolve-server-name-or-service-not-known). Hoje, tamb√©m iremos falar do EFS, mas sobre como a utiliza√ß√£o desse servi√ßo pode se tornar um problema em alguns contextos. 

## **O que √© o EFS?**

EFS √© um dos servi√ßos que a AWS nos oferece, e se destaca por ser, basicamente, um File System NFS na nuvem de baix√≠ssimo custo. Ele foi criado com o intuito de fornecer acesso compartilhado e paralelo para at√© milhares de inst√¢ncias EC2, permitindo que sua aplica√ß√£o forne√ßa alto n√≠vel em taxa de transfer√™ncia com **baixa lat√™ncia**.

Se eu consigo ter um volume de arquivos compartilhados em m√∫ltiplas inst√¢ncias EC2, isso quer dizer que eu posso ter um bloco espec√≠fico de c√≥digo compartilhado entre todas elas? Bom, n√£o √© bem isso. O servi√ßo deixa alguns pontos n√£o t√£o claros na sua landing page de apresenta√ß√£o, mas se olharmos um pouco mais a fundo a [documenta√ß√£o oficial](https://docs.aws.amazon.com/efs/latest/ug/whatisefs.html), iremos encontrar alguns detalhes bem interessante. Por enquanto, iremos focar em uma bem espec√≠fica: a lat√™ncia.

## Lat√™ncia

Lat√™ncia, quando falamos em redes de computadores, √© o tempo que que leva para os pacotes percorrerem o caminho entre o ponto X e o Y. Quanto mais alta a lat√™ncia, mas tempo a transmiss√£o demora para ocorrer. 

Como sabemos, na internet cada mil√©simo de segundo conta. E no EFS o modo de entrega, e a limita√ß√£o dos recursos s√£o um pouco diferentes do que n√≥s j√° estamos acostumados em outros servi√ßos da AWS, veja a tabela abaixo:

![Comportamento de intermit√™ncia para sistemas de arquivos no EFS](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/66a3a39e-9ea5-4336-b51a-4a94af394832/Untitled.png)

Veja mais detalhes na [documenta√ß√£o sobre perfomance do EFS](https://docs.aws.amazon.com/efs/latest/ug/performance.html).

### Cr√©ditos de intermit√™ncia acumulada

A AWS usa um sistema de cr√©ditos no EFS para determinar quando o File system vai "explodir", que √© determinado pelo tamanho dos arquivos, pela quantidade de arquivos, e pelo tempo que esses arquivos ficam "parados" no seu sistema de arquivos. 

Quanto maior o tamanho dos seus arquivos e menos voc√™ utiliz√°-los, mais cr√©ditos voc√™ ter√°, e mais r√°pidos seus arquivos ser√£o entregues as inst√¢ncias que compartilham o sistema de arquivos.

Ou seja, √© muito mais barato, em lat√™ncia, ter 2 arquivos de 1 GB cada, do que ter 50 arquivos de 1KB cada. Veja mais detalhes [neste post](https://www.jeffgeerling.com/blog/2018/getting-best-performance-out-amazon-efs).
